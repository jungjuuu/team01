<html xmlns:th="http://www.thymeleaf.org">
<head>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
	<link rel="stylesheet" href="/css/team01.css">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
	crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
.product-item img {
	width: 340px; /* 원하는 너비 */
	height: 200px; /* 원하는 높이 */
	object-fit: cover; /* 이미지 비율 유지 */
}

/*이미지 슬라이드*/
body {
	margin: 0;
	padding: 0;
	display: flex;
	flex-direction: column;
	min-height: 100vh;
}
/**/


.slider__wrap {
	width: 100%;
	height: 500px; /* 슬라이더 높이 조정 */
	overflow: hidden;
}

.slider__img {
	width: 100%;
	height: 100%;
	overflow: hidden;
}

.slider__inner {
	display: flex;
	transition: transform 0.9s ease;
	height: 100%;
}

.slider {
	flex: 0 0 100%;
	width: 100%;
	height: 100%;
}

.slider img {
	width: 100%;
	height: 100%;
	object-fit: contain;
}



/*더보기*/
#container {
	display: inline;
}

#btn {
	border: none;
	background-color: transparent;
	padding: 0;
	font-size: 17px;
	cursor: pointer;
}

#btn2 {
	border: none;
	background-color: transparent;
	padding: 0;
	font-size: 17px;
	cursor: pointer;
}




#cardContainer .col:nth-child(n+6) {
	display: none;
}

/*가을룩*/
</style>
</head>
<body>
<div th:insert="header :: header"></div>
	<div class="slider__wrap">
		<div class="slider__img">
			<div class="slider__inner">
				<div class="slider">
					<img src="/images/slide01.png" alt="이미지1">
				</div>
				<div class="slider">
					<img src="/images/slide02.png" alt="이미지2">
				</div>
				<div class="slider">
					<img src="/images/slide03.png" alt="이미지1">
				</div>
				<div class="slider">
					<img src="/images/slide04.png" alt="이미지1">
				</div>
			</div>
		</div>
	</div>


	<main id="container" class="product-item flex-grow-1"
		style="background-color: white; padding: 50px;">
		<div style="font-size: 3ex; font-weight: 600;">Most Popular</div>
    <div style="margin-bottom: 2ex; font-size: 2ex; color: gray;">인기 상품</div>
    <div id="cardContainer" class="row row-cols-1 row-cols-md-5 g-4">
        <div class="col" th:each="product : ${popularProducts}">
    <div class="card h-100">
        <a th:href="@{'/products/detail/' + ${product.productNo}}"
           style="text-decoration: none; color: black;">
            <img th:src="@{'/images/' + ${product.productImage}}" class="card-img-top" alt="상품 이미지">
        </a>
        <div class="card-body">
            <a th:href="@{'/products/detail/' + ${product.productNo}}"
               style="text-decoration: none; color: black;">
                <h5 class="card-title" th:text="${product.productName}">상품명</h5>
                <p class="card-text" th:text="${product.productPrice} + ' 원'">가격</p>
            </a>
            <!-- 좋아요 버튼 -->
            <button class="like-button p-2" th:data-product-no="${product.productNo}">
                <i class="bi" th:classappend="${product.liked} ? 'bi-heart-fill' : 'bi-heart'"></i>
            </button>
            <span th:text="'Likes: ' + ${product.likesCount}"></span>
        </div>
    </div>
</div>
    </div>
		<div class="text-center mt-4"
			style="text-align: center; margin-top: 20px;">
			<button id="btn" type="button" class="btn btn-outline-secondary">더보기v</button>
		</div>
		<div style="font-size: 3ex; font-weight: 600;">NEW
				IN</div>
		<div style="margin-bottom: 2ex; font-size: 2ex; color: gray;">신규 등록 상품</div>
		<div id="cardContainer2" class="row row-cols-1 row-cols-md-5 g-4">
			<div class="col" th:each="product : ${newProducts}">
					<div class="card h-100">
				<a th:href="@{'/products/detail/' + ${product.productNo}}" style="text-decoration: none;">
						<img th:src="@{'/images/' + ${product.productImage}}"
							class="card-img-top" alt="상품 이미지"></a>
						<div class="card-body">
						 <a th:href="@{'/products/detail/' + ${product.productNo}}"
							style="text-decoration: none; color: black;">
							<h5 class="card-title" th:text="${product.productName}">상품명</h5>
							<p class="card-text" th:text="${product.productPrice} + ' 원'">가격</p>
						</a>
					<!-- 좋아요 버튼 -->
					<button class="like-button"
						th:data-product-no="${product.productNo}">
						<i class="bi"
							th:classappend="${product.liked} ? 'bi-heart-fill' : 'bi-heart'"></i>
					</button>
					<span th:text="'Likes: ' + ${product.likesCount}"></span>
						</div>
				</div>
			</div>
		</div>
		<div class="text-center mt-4"
			style="text-align: center; margin-top: 20px;">
			<button id="btn2" type="button" class="btn btn-outline-secondary">더보기v</button>
		</div>
	</main>
	<div id="container" class="product-item flex-grow-1"
		style="background-color: white; padding: 50px;">
		<div style="font-size: 3ex; font-weight: 600; margin-top: 10px;">OUT
			LOOK</div>
		<div style="margin-bottom: 2ex; font-size: 2ex; color: gray;">요즘
			무드 가을룩</div>
	</div>

</body>
 <div th:insert="footer :: footer"></div>

<script>
	//이미지 슬라이드
	const sliderInner = document.querySelector(".slider__inner");
	const sliders = document.querySelectorAll(".slider");
	let currentIndex = 0;
	const sliderCount = sliders.length;

	function slideNext() {
		currentIndex = (currentIndex + 1) % sliderCount;
		sliderInner.style.transform = `translateX(-${currentIndex * 100}%)`;
	}

	setInterval(slideNext, 3000);

	/*더보기*/
	document.addEventListener('DOMContentLoaded', function() {
		var cardContainer = document.getElementById("cardContainer");
		var cardContainer2 = document.getElementById("cardContainer2");
		var btn = document.getElementById("btn");
		var btn2 = document.getElementById("btn2");
		var initialCards = 5; // 초기 카드 수
		var initialCards2 = 5; // 초기 카드 수
		var cardsToShow = 5; // 더보기 클릭 시 추가 카드 수
		var cardsToShow2 = 5; // 더보기 클릭 시 추가 카드 수
		var totalCards = cardContainer.children.length; // 총 카드 수
		var totalCards2 = cardContainer2.children.length; // 총 카드 수
		var visibleCards = initialCards; // 현재 보이는 카드 수
		var visibleCards2 = initialCards2; // 현재 보이는 카드 수

		// 초기에 카드 표시
		updateCardVisibility();

		btn.addEventListener('click', function() {
			visibleCards += cardsToShow; // 보이는 카드 수 증가
			updateCardVisibility();

			// 모든 카드가 보이면 버튼 숨김
			if (visibleCards >= totalCards) {
				btn.style.display = 'none';
			}
		});
		
		updateCardVisibility2();
		
		btn2.addEventListener('click', function() {
			visibleCards2 += cardsToShow2; // 보이는 카드 수 증가
			updateCardVisibility2();

			// 모든 카드가 보이면 버튼 숨김
			if (visibleCards2 >= totalCards2) {
				btn2.style.display = 'none';
			}
		});

		function updateCardVisibility() {
			for (var i = 0; i < totalCards; i++) {
				if (i < visibleCards) {
					cardContainer.children[i].style.display = 'block'; // 카드 표시
				} else {
					cardContainer.children[i].style.display = 'none'; // 카드 숨김
				}
			}
		}
		
		function updateCardVisibility2() {
			for (var i = 0; i < totalCards2; i++) {
				if (i < visibleCards2) {
					cardContainer2.children[i].style.display = 'block'; // 카드 표시
				} else {
					cardContainer2.children[i].style.display = 'none'; // 카드 숨김
				}
			}
		}
	});
	
	$(document).ready(function () {
	    $('.like-button').click(function () {
	        var productNo = $(this).data('product-no');
	        var $button = $(this);

	        $.ajax({
	            url: '/like/click',
	            type: 'POST',
	            data: { productNo: productNo },
	            success: function (response) {
	                if (response === 'added') {
	                    $button.find('i').removeClass('bi-heart').addClass('bi-heart-fill');
	                } else if (response === 'removed') {
	                    $button.find('i').removeClass('bi-heart-fill').addClass('bi-heart');
	                }

	                // 좋아요 수 업데이트
	                updateLikeCount(productNo, $button);
	            },
	            error: function () {
	                alert('오류가 발생했습니다.');
	            }
	        });
	    });

	    // 좋아요 수 업데이트 함수
	    function updateLikeCount(productNo, $button) {
	        $.ajax({
	            url: '/like/count',
	            type: 'POST',
	            data: { productNo: productNo },
	            success: function (count) {
	                $button.siblings('span').text('Likes: ' + count);
	            },
	            error: function () {
	                console.error('좋아요 수 업데이트 오류');
	            }
	        });
	    }
	});

</script>

</html>